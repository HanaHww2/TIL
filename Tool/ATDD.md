# ATDD (Acceptance Test Driven Development) 인수 테스트 주도 개발
- ATDD는 고객, 개발자, 테스터 간의 커뮤니케이션을 기반으로 하는 개발 방법론으로써, 고객-개발자-테스터 간의 협업을 강조한다는 점에서 TDD와는 다르다.
  - 인수테스트는 고객이 제품을 인수하기 전, 명세나 계약의 요구사항이 모두 충족되었는지 확인하기 위해 수행되는 테스트이다.
  - 개발자는 코딩을 시작하기 전 인수 테스트를 먼저 작성해야 한다.

## 장점
1. 개발을 시작하기 전, `요구사항`을 명확히 함으로써 고객, 개발자, 테스터 간의 빠른 피드백을 받을 수 있다.
2. 개발을 시작하기 전, 인수 테스트 코드를 먼저 작성함으로써 `구현할 대상`에 대한 이해도를 높힐 수 있다.
3. 작업의 시작과 끝이 명확해진다. 인수 테스트가 통과한다면 기능 개발이 끝난 것이다.
4. 리팩토링을 부담없이 할 수 있다. 많은 레거시 코드에서의 비즈니스 로직에는, 테스트하기 쉬운 부분과 어려운 부분이 뒤섞여있다. 따라서 레거시 코드를 리팩토링할 때 많은 어려움이 있다. 이때 인수 테스트 코드를 작성해놓는다면, 인수 테스트 코드의 보호 아래 기존 기능을 망가뜨리지 않고 리팩토링과 기능 추가를 자유롭게 할 수 있다.

## 규칙
1. 코딩을 시작하기 전에 인수 테스트를 먼저 작성한다. 이후 TDD 사이클을 통해 개발을 진행한다.
2. 인수 테스트 코드는, 내부 구현이나 기술에 의존적이지 않는 **블랙 박스 테스트**로 작성한다. 쉽게 말하자면, 인수 테스트 코드 import 문에 프로덕션 코드가 없으면 된다.

## 구현
### RestAssured 사용시 주의사항 및 테스트 DB 관리
- RestAssured는 테스트 시, 어플리케이션을 톰캣 위에 올려서 테스트 한다. 즉 실제와 똑같은 환경에서 테스트를 진행하기 때문에 테스트 코드에서 시작한 Transaction을 전파(Propagation)할 수가 없다. (Transactional 어노테이션을 이용한 롤백 사용 불가)
-  SpringBootTest는 ApplicationContext를 전부 올리는 테스트이므로 꽤나 큰 부하를 갖는다. 그렇기에 여러 개의 SpringBootTest가 있을 경우 ApplicationContext를 공유하게 된다. h2 데이터베이스도 마찬가지로 공유하게 된다.
- 각 테스트는 독립적으로 수행되어야 하므로 이를 위해 DatabaseCleanup 클래스는, 모든 테스트가 시작하기 전, 데이터베이스의 모든 데이터를 삭제해주는 역할을 한다.

### 구현 특징
1) 하나의 테스트 코드가 여러개를 검증한다.

 원래는 하나의 테스트 코드는 하나만 검증하는 게 원칙이다. 하지만 그렇게 되면 중복 코드가 많이 생기게 될텐데, SpringBootTest는 그렇게 구성하기엔 부하가 많이 걸리는 테스트이다. 따라서 사용자의 사용 시나리오를 기반으로 Happy Case에 대해서만 인수 테스트를 작성한다.
2) 기능 목록에는 예외 상황들이 많은데, 이에 대한 테스트 코드가 하나도 없다.

 위와 같은 이유이다. 예외 상황에 대한 테스트까지 추가한다면 시간이 너무 오래 걸릴 것이다. 따라서 인수 테스트에서는 Happy Case에 대해서만 작성하고, 예외 상황에 대해서는 단위 테스트에서 검증하도록 한다.

3) 메서드가 모두 한글로 작성되어있다.

 물론 테스트 코드에선 한글로 많이 작성하기도 한다. 인수 테스트에선 더욱 이렇게 하는 것이 좋은데, 그 이유는 인수 테스트는 오직 개발자만을 위한 것이 아니라 고객, 개발자, 테스터 간의 커뮤니케이션을 위한 것이기도 하기 때문이다.


### 참고자료
- https://mslim8803.tistory.com/58