# Concurrency 동시성

# 경쟁 상태(Race Condition)
- 공유 자원(데이터)에 여러 프로세스가 동시에 접근을 시도할 때, 이 접근 타이밍이나 순서 등이 결과값에 영향을 줄 수 있는 상태를 말한다.
- 공유 자원에 여러 프로세스가 동시에 접근할 때 자료의 일관성을 해치는 결과가 나타날 수 있다. ➡ Race Hazard 경쟁 위험

### 경쟁상태가 발생하는 경우
1. 커널 모드 실행 중에 인터럽트가 발생할 경우  
   - 커널의 전역변수는 모든 프로세스의 공유자원이므로, 경쟁상태의 가능성이 있다.
   커널 모드에서 데이터를 로드하여 작업을 하던 도중 인터럽트가 발생하여, 다른 사용자 스레드(프로세스)가 같은 데이터를 조작하는 경우에 발생할 수 있다. 
  >➡ 커널 모드에서 작업을 수행하는 동안 인터럽트를 disable시켜 인터럽트가 CPU제어권을 가져가지 못하도록 하여 해결할 수 있다.

2. 프로세스가 시스템 콜을 하여 커널 모드로 진입해 작업을 수행하는 도중에 문맥 교환(인터럽트)이 발생하는 경우
   - 프로세스1이 커널 모드에서 데이터를 조작하던 도중 시간이 초과되어 CPU 제어권이 프로세스2로 넘어가고, 프로세스2가 같은 데이터를 조작하는 경우를 들 수 있다.
  > ➡ 프로세스가 커널 모드에서 작업을 하는 경우에는 시간이 초과되더라도, CPU 제어권이 다른 프로세스에게 넘어가지 않도록 한다.

3. 멀티 프로세서에서 공유 메모리 내의 커널 데이터에 접근할 경우
   - 멀티 프로세스 환경에서 2개의 CPU가 동시에 커널 내부의 공유 데이터에 접근하여 조작하는 경우에 발생할 수 있다.
   - 멀티 스레드 환경에서 두 개 이상의 스레드가 공통의 전역변수에 접근할 경우 등에서 race condition이 발생할 수 있다
  > ➡ 커널 내부의 공유 자원에 접근할 때, lock/unlock을 이용한 제어를 지원함으로써 해결할 수 있다.

### 참고자료)
- https://velog.io/@klloo/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C-%EA%B2%BD%EC%9F%81-%EC%83%81%ED%83%9C-Race-Condition
  
# DeadLock 데드락
- 프로세스나 스레드가 필요한 자원을 얻지 못해서 다음 처리를 하지 못하는 상태를 말한다.
  - 무한정 자원을 기다리게 된다.

## 데드락의 발생조건
1. 상호배제(Mutual Exclusion)
2. 점유 대기(Hold and wait)
3. 비선점(No preemption)
4. 순환 대기(Circular wait)

## 데드락 해결 방안
### 예방 및 회피
#### 예방
- 교착 상태 발생 조건 중 하나를 제거하여 해결하는 방식을 말한다.

#### 회피
- 교착 상태가 발생하는 것을 피한다.
- 은행원 알고리즘을 활용한다.
  - 은행원 알고리즘이란 프로세스에 자원을 할당하기 전에, 시스템이 자원을 할당한 뒤에도 안정 상태로 남게 되는지 먼저 검사하고 할당하는 방식을 통해 교착 상태를 회피한다.

### 탐지 및 회복
교착 상태가 되도록 허용한 다음 회복시키는 방법이다.
#### 탐지 Detection
- 자원 할당 그래프를 이용해 교착 상태를 탐지한다.
- 자원 요청이 발생할 때마다, 탐지 알고리즘이 실행되므로 오버헤드가 발생한다.
#### 회복 Recovery
**프로세스 종료 방법**
- 교착 상태를 일으킨 프로세스를 종료하거나 할당된 자원을 해제함으로써, 데드락을 해소한다.
- 프로세스 종료 방법은 아래와 같다.
  - 교착 상태의 프로세스를 모두 중지하거나, 교착 상태가 제거될 때까지 하나씩 프로세스를 중지할 수 있다.

