- 구글링을 통해 여러 글을 서치하고, chatGPT를 통해 질답하여 내용을 정리합니다.
- chatGPT를 이용한 질답을 통해서 내용을 보다 빠르게 정리할 수 있었습니다.

# DBMS의 키 생성 전략
- 키를 자동으로 생성하는 것을 돕기 위해, DBMS 는 몇 가지 전략을 제공한다.

## Sequence
- 첫 번째로 Oracle 과 Postgresql 등 이 제공하는 Sequence 전략이 있다.

> Sequence: is a database object that generates unique numbers, typically used as a primary key for a table. 
> It is not tied to a specific table and can be used across multiple tables.

- 여러 테이블에서 하나의 시퀀스를 함께 활용할 수 있지만, 키 값이 분산된다.
- 보편적으로 테이블 별로 시퀀스를 생성하는 전략을 활용한다.
> Typically, it is a best practice to have one sequence per table to ensure uniqueness and independence between tables. 
> This means that each table has its own sequence, which generates unique primary key values only for that table.

- 그러나, 여러 테이블에서 유니크한 값을 갖는 키를 사용할 필요가 있다면 하나의 시퀀스를 여러 테이블이 활용할 수 있다.
> However, in some cases, it is possible to use the same sequence for multiple tables 
> if the columns are used for different purposes and the values generated by the sequence are guaranteed to be unique. 
> For example, you could use a single sequence for generating unique IDs for multiple tables that represent different entities, 
> as long as the values generated by the sequence are guaranteed to be unique across all tables.

- 즉 사용자는 경우에 따라, 적절히 활용한다.

### 동작 방식
> When using a sequence to generate primary keys, uniqueness is guaranteed by the database management system in the following ways:
> 1. Sequence increment value
>   - The sequence is created with a specific increment value, which determines the step size for the values generated by the sequence. 
> This ensures that each time the NEXT VALUE function is called for the sequence, it generates a unique value.
> 2. Atomicity
>   - The process of generating the next value from the sequence and inserting it into a table is an atomic transaction, meaning it is indivisible and cannot be interrupted. 
> This ensures that even in multi-user environments, the sequence generates unique values without any concurrent access issues.
> 3. Sequence state
>   - The state of the sequence is stored in the database, and its current value is automatically incremented every time the NEXT VALUE function is called. 
> This ensures that even if the database crashes or there is a power failure, the sequence continues to generate unique values.

- 시퀀스가 생성될 때, 특정한 증가 값과 함께 정의된다.
- 트랜잭션(원자성을 갖춘)을 통해, 시퀀스가 활용되므로, 동시성 이슈에서 안전하다.
- 시퀀스의 상태는 데이터베이스에 저장되므로, 지속성이 보장된다.
 
### ddl
- 두 가지 예시를 gpt에서 얻었는데, 테스트를 해보거나 차이를 찾아보아 할 것 같다.
```sql
-- ex1.
CREATE SEQUENCE my_seq
START WITH 1
INCREMENT BY 1;

CREATE TABLE my_table (
  id NUMBER PRIMARY KEY,
  col1 VARCHAR2(50),
  col2 VARCHAR2(50)
);

-- 키 자동 생성
CREATE TRIGGER my_table_trig
BEFORE INSERT ON my_table
FOR EACH ROW
BEGIN
  SELECT my_seq.NEXTVAL INTO :new.id FROM DUAL;
END;

-- ex2.
CREATE SEQUENCE sequence_name
  START WITH 1
  INCREMENT BY 1;

CREATE TABLE table_name (
  id NUMBER(10) PRIMARY KEY,
  column2 datatype [DEFAULT expression] [NULL | NOT NULL],
  ...
  CONSTRAINT constraint_name PRIMARY KEY (id) -- 단순히 제약조건 명을 지정하기 위해 직접 작성하는 것이 맞는지??
);

ALTER TABLE table_name
  ADD (CONSTRAINT constraint_name DEFAULT sequence_name.NEXTVAL
       FOR id);
```

## auto increment
- mysql에서 대표적으로 제공하는 키 생성 전략이다.
> Auto increment: is a feature in some databases that automatically generates a unique number for a column (often the primary key) when a new row is inserted into the table. 
> It is tied to a specific column in a specific table.

## 비교
> Both sequences and auto increments are used to generate unique values for primary keys, 
> but sequences are more flexible and can be used across multiple tables, while auto increments are tied to a specific column in a specific table.
